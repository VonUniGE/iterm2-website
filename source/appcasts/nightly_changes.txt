2020-07-09: Fix crash when using non-master tmux

2020-07-09: Avoid constantly re-creating status bar icons.
The test for whether the imageview's image equals the
provided image for the status bar component always failed
because I guess the imageview changes the image at some
point on its own. This commit adds a new api for cacheable
images. It's fine to cache status bar images because they're
tiny and you usually don't change them much. An attempt to
fix issue 8978

2020-07-09: [python] Bump version

2020-07-09: [python,api] Add Arrangements.async_list. Issue
9004

2020-07-09: Fix compact windows entering full screen in big
sur: there was a gray rectangle in full screen under the tab
bar. This also affects older versions of macOS because I
moved the call to updateTabBarControlIsTitlebarAccessory in
windowDidEnterFullScreen to after lionFullScreen_=YES which
it needs in order to reason correctly about whether it
should be a titlebar accessory. This will either fix a bunch
of bugs or create a bunch of bugs, or maybe both. sigh

2020-07-09: Move tabbar out of title bar in big sur because
it looks bad with 4 points of empty space under it

2020-07-09: Make third party packages buildable via the
makefile. Build them all for ARM & x86.

- Remove x86-specific CPU profiling. Rebuild CoreParse as a
fat framework - Build fat libsixel archive - Build fat color
picker framework - Build fat better font picker - Build fat
searchable combo list view - Add openssl submodule - Update
openssl submodule to include stuart's patch - Add makefile
targets to build openssl - Add libssh2 submodule - Add
makefile targets for fat libssh2 - Add fat NMSSH binary -
Add copy phase to fatlibssh2 - Commit fat sparkle framework
- Fix warnings - Fix warnings - Fix capitalization - Improve
libsixel makefile target - Rebuild libsixel-x86 with 10.12
deployment target - Add fat libsixel

2020-07-08: Turn off escapeWithQuotes advanced pref. See
analysis in issue 9003

2020-07-08: Daemonize iTermServer and have it die when the
bootstrap port dies. Issues 9000 and 8986.

2020-07-06: Fix layout bugs in 10.5 for command history and
captured output toolbelts

2020-07-06: Allow prompt to change length. Accept multiple
FTCS B sequences. Issue 8996

2020-07-06: Free unused images after session restoration
completes. Issue 8840

2020-07-06: Add support for tmux subscriptions. See
https://github.com/tmux/tmux/issues/2242

2020-07-06: Preserve scroll position of top line during
window resize. Issue 8989

Also fix scrollLineNumberRangeIntoView, which was horribly
broken (sometimes scrolling half a line in at the top).

2020-07-05: Make windows draggable by the status bar.
Prevent dragging a window by its titlebar if the window
should not be draggable. Issue 8993

2020-07-05: Fix failing tests

2020-07-05: Fix support for ZWJ in emoji

2020-07-05: Suppress stoplight hotbox when the search field
would be under it

2020-07-04: Fix wrong URL encoding for sematic history paths
(#422)

This fixes wrong encoding of paths when cmd-clicking on
existing files in sematic history to for example open the
file in MacVim or a custom URL.

The problem is that URLHostAllowedCharacterSet does not
contain the slash character, so eg. /Users/foo/bar baz.txt
is encoded as %2FUsers%2Ffoo%2Fbar%20baz.txt instead of the
correct /Users/foo/bar%20baz.txt.

While some application might not care this at least breaks
opening files in MacVim, which requires proper path
encoding.

This changes to use the correct URLPathAllowedCharacterSet
instead.

It is possible that URLHostAllowedCharacterSet contained "/"
in the past, even though it is not a valid character for the
host part of a URL and Apple fixed it it newer SDK versions.
2020-07-04: Update libsixel. Add makefile target to build it

2020-07-04: Fix big sur window border

2020-07-04: Disable window border feature on 10.16. I am
hopeful that it is no longer necessary now that I have fixed
the problem where window borders disappear for transparent
windows.

2020-07-04: Enable window shadow with blur on 10.16. Work
around a bug where blur would sometimes break when toggling
blur or use transparency.

2020-07-04: When transparent, don't set the background color
to clear. Instead, make it really close to clear. Apparently
this helps performance according to
https://notes.yvt.jp/Desktop-Apps/Enabling-Backdrop-Blur
because alpha of 0 is for irregularly shaped windows. I hold
hope that this means I can use the shadow again, too

2020-07-04: Use CGSDefaultConnectionForThread instead of
CGSMainConnectionID based on
https://notes.yvt.jp/Desktop-Apps/Enabling-Backdrop-Blur

2020-07-03: Add libsixel submodule

2020-07-03: Add Sparkle submodule

2020-07-03: Add CoreParse submodule

2020-07-03: Add my fork fo NMSSH as a submodule

2020-07-03: Remove bad test for whether mouse reporting
should start for a 3-finger drag. The removed code rested
whether mouse reporting was allowed in prefs, which is silly
because it's usually allowed in prefs but not usually
actually enabled. Furthemore, this code was unreachable when
the drag was reported because it returned early from the
function. Issue 8992

2020-07-03: Make minimal and compact windows draggable by
the area near the top (if top tabs) or bottom (if bottom
tabs) of the tabbar. Issue 8046

2020-07-03: Add the ability to hide empty status bar
components. Issue 8517

2020-07-03: Fix a bug where component knobs couldn't get
first responder.

2020-07-03: [python] Update menu IDs

2020-07-03: [python] Add sync_title

2020-07-02: Start implementing filter. TODO: Figure out a UI
and then call -[PseudoTerminal filter:]. The current
implementation uses the find pasteboard which is impossible
for users to comprehend. Issue 3039

2020-06-29: Try to unbreak the nightly build for big sur
users

2020-06-29: Make the tabbar opaque when the window's
background is clear.

2020-06-29: Switch to within-window blending for the tabbar
backing doesn't appear translucent. This reverts
6328686a8e989dd5a2ac7ba3fcd918020c623a84. I can't reproduce
the problem that commit's message describes

2020-06-29: Force the tab bar to be a visible titlebar
accessory while entering fullscreen, and then set its max
height to 0 if it should be collapsed. Issue 8981

2020-06-29: Promote pref to make LSUIElement require only
hotkey windows out of advanced prefs. Default it to off
instead of on. Issue 8980

2020-06-29: Fix shortcut input view pre-big sur. Apparently
the changes I made to the sheet it's in for the hotkey
window made its window never key.

2020-06-28: Fix hamburger image on 10.15

2020-06-28: Fix build on 10.15 sdk

2020-06-28: More improvements to big sur table views in the
toolbelt. Standardize on the play symbol for action buttons

2020-06-28: Update toolbelt UIs for big sur, other than
table views

2020-06-28: Make profile list view use inset table view

2020-06-28: Update advanced prefs for big sur

2020-06-28: Update pointer actions for big sur

2020-06-28: Update key mapping table for big sur

2020-06-28: Fix table views and sheets for big sur

2020-06-28: [bfp] Use inset style, add a fudge factor for
the 'secret' inset amout

2020-06-28: Clean up searchable combo list view

2020-06-28: Hack better font picker for big sur. There's a
lot of fudge factors here :(

2020-06-28: Replace hamburger with ellipsis.circle for big
sur

2020-06-28: Update tab activity indicator for big sur

2020-06-27: Fix window borders for big sur

2020-06-27: Fix add tab button in big sur

2020-06-27: Improve appearance of tab bar on big sur. Fix a
bunch of bugs, including top line in dark mode.

2020-06-27: Fix sdk version checks for big sur

2020-06-27: Work around big sur misaligning title bar
accessory views

2020-06-27: Fix shortcut title bar accessory view appearance
on bug sur

2020-06-26: Only apply 'exclude from app switcher' setting
when all windows are hotkey windows (#420)

Add advanced pref to disable LSUIElement when there are
non-hotkey windows.

Co-authored-by: George Nachman <gnachman+github@gmail.com>
2020-06-25: Don't save window state except for hotkey
windows when not using system window restoration. I should
eventually change the behavior for hotkey windows, too, but
that will be more involved because it'll break workflows.
Issue 8960.

2020-06-25: Add FUNDING.yml

2020-06-25: Fix false pause detections. Negative slope
predicted a pause in the past, which is not a useful
prediction, so ignore negative slopes. Also require five
consecutive redzone predictions before warning to deal with
momentary latency spikes.

2020-06-25: Unbreak the build on Xcode 11

2020-06-25: [bigsur] Fix misbehaved search field in prefs

2020-06-24: Get prefs search field more or less working in
big sur

2020-06-24: Improve appearance of regular tabs in big sur

2020-06-23: Refactor tmux response handling. Fix a bug where
if a command early in a list with a nil target got an error
then the rest of the list would not be canceled, causing a
hang.  Tolerate errors from refresh-client -C. Issue 8943.

2020-06-23: Fix logic for adjusting tmux layout. If the root
view is larger than the flexible view, you really have to
resize it or content will be outside the visible bounds. If
it's smaller by more than one cell, that should also be
fixable.

2020-06-21: Remove Travis. It's broken beyond repair.

2020-06-21: Make window borders 1 pt thick in dark theme.
See email with subject line 'Iterm2 border wider than one
pixel'

2020-06-21: Add xscode link

2020-06-21: Fix failing test

2020-06-21: Remove more ruby crap to get travis working

2020-06-21: Fix a bug where ThreeFingerTapGestureRecognizer
incorrectly looked for >3 touches on the *previous* count of
touches rather than the current count. That allowed a
four-finger tap to be treated as a three finger tap, which
causes quicklook activations when swiping between desktops.
Issue 8955

2020-06-21: Stop using ruby in CI because both Ruby and
Travis are kinda broken. Travis fails while trying to
install libxml, which seems to be related to ruby. This
loses code coverage, but I didn't even know we had that...

2020-06-21: Switch a bunch of experimental features to
always on in preparation for 3.4

2020-06-21: Move master to 3.4.x

2020-06-21: Fix warning when ASAN is enabled

2020-06-21: Fix version number in warning

2020-06-21: Bump minimum python version for betas

2020-06-21: Do not accept older format .its files

2020-06-21: Fix warning

2020-06-21: Fix duplicate main menu identifiers

2020-06-21: Advertise that PTYSession conforms to
iTermTmuxControllerSession

2020-06-21: Remove duplicate references in project file,
suggested by xcode upgrade

2020-06-21: Update window opacity when the profile changes
transparency. Issue 7327

2020-06-21: Fix a bug where session logs could be corrupted.
Issue 8959

2020-06-20: Move nontrivial screen parameters change check
into presentation controller. Fix coalescing. General clean
up

2020-06-20: Avoid disabling metal when the app is activated.
For some reason we get screenParametersChanged sometimes
upon activation which causes metal to be deactivated at the
worst possible time.

2020-06-19: Disable metal during split pane dragging for
tmux sessions. Issue 8954.

2020-06-18: Fix a bug where native fullscreen is broken on
10.15.5 because we set the style mask to not-fullscreen from
refreshTerminal when the window's effective appearance
changes just before didEnterFullScreen. Issue 8945

2020-06-18: Cancel mouse reporting frustration detection
when we get a control sequence to copy to the clipboard.
Issue 8905

2020-06-18: Update presentation controller after adding or
removing a window from iTermController instead of after
initializing a full screen window. It has no effect before
the window is added to the controller. Issue 8951

2020-06-18: Add support for tmux wait-exit. See
https://github.com/tmux/tmux/issues/2246

2020-06-16: When tmux variable window sizes are in use, do
not automatically resize them. This is a little gross when
there are two clients connected and the other one does a
live resize. But other than that it's a much better
experience because the window size stays stable as you
create and destroy split panes.

2020-06-16: Fix rounding calculation for variableTmuxSize.

2020-06-16: Fix frame of metal view in tmux integration with
extra margin on the bottom

2020-06-16: Fix warning

2020-06-15: Avoid setting the style mask or frame while
toggling full screne. Issue 8945

2020-06-14: Add terminal state submenu to context menu.
Issue 8947

2020-06-14: Add a hacky workaround for the background color
view not being updated in issue. 8843

2020-06-13: Try to use autosave window frame when anchored
to a screen, provided that frame is on the proper screen.
Issue 8944

2020-06-13: cmd-click on a file: url with a fragment now
open using semantic history. If it has a #line or #line:col
fragment, it opens to that line.

2020-06-13: Invalidate app restorable state after adding a
URL to the store

2020-06-13: Make the URL hover view prettier

2020-06-13: Invalidate app restorable state after adding an
image

2020-06-13: Change CSI u mode to send control-/ but to treat
control-? as backspace. Issue 8382

2020-06-13: Fix swipe when it enters a tmux integration
session. It was using root_ when it should have been using
flexibleView_, which is the parent of root_.

2020-06-13: Fix color of about box error message. Arcify
iTermAboutWindowController.m. Sort names lexicographically.

2020-06-13: When erasing the display after the cursor or the
line after the cursor and the cursor is in the first column
make the preceding line EOL_SOFT. Issue 8938.

2020-06-13: Make IntelliJ IDEA a first class citizen of
semantic history; it is now available as an editor

2020-06-13: Fix support for older versions of tmux because
of bad minimumServerVersion check. Send pause-after=0
immediately to quell noisy panes during setup.

2020-06-12: Update shell integration utilities for website
commit 021b058

2020-06-12: Clear pause warning when silence occurs on a
pane. Fix manual unpause pane

2020-06-12: Add support for manually pausing/unpausing panes

2020-06-11: Add auto-unpause. Move warn before pausing to
general prefs

2020-06-11: Add support for %extended-output from tmux 3.2+

2020-06-11: only update buffer size time series once a
second to make the results more stable and use less cpu

2020-06-11: Fix bad cherrypick

2020-06-11: Fix a bug in how we calculate the tmux window
size for variable-size windows.

Previously, we calculated the desired tmux window size by
adding the smallest content size to the number of dividers.
That wasn't quite right, though. Sometimes you need to use
the *largest* content size instead, because that gets you a
smaller result. There was a tab like:

+-------+ |   |   | |   |   | |   +---| |   |   | |   |   |
+-------+

When the divider is thin and there's no per-pane title bar,
the window size is constrained by the tall pane because
tmux's divider is thicker than iTerm2's. The result is that
-variableTmuxSize returned a size that was a little too big.
That kicked off a vicious cycle:

1. Cause a layout change, such as by dragging a pane divider
or resizing the window. The layout size we request is too
big because of this bug.  2. Tmux sends %layout-change.  3.
TmuxWindowOpener updates the layout.  4. The flexible view
is smaller than the split view because the layout size that
came back was bigger than the window.  5. layoutIsTooLarge
return YES.  6. TmuxWindowOpener calls fitLayoutToWindows.
7. It resizes the window to its current size.  8. GOTO 2.

Issue was reported by ashturm via chat.

2020-06-10: Disable metal during tmux split drag. Fix
implementation of
sessionViewShouldUpdateSubviewsFramesAutomatically which got
negated at some point.

2020-06-10: Enable pause mode only after guessing tmux
version

2020-06-10: Fix build

2020-06-10: Finish implementing preliminary support for tmux
pause mode. Still some changes coming, like
%extended-output. https://github.com/tmux/tmux/issues/2217

2020-06-09: Fix a bug where the 'restore full screen
windows' prompt was given if there were no windows to
restore and canceling didn't reset the counter so it would
keep asking after a cancel.

2020-06-09: Fix a bug where restoring a tmux controller
didn't set the DCS unique ID so that when an invalid token
is received it wasn't able to break the parser out of the
DCS hook. Issue 8936

2020-06-09: Set echo probe duration to 0 to disable probing

2020-06-09: Update regex for http(s) URLs to ignore parens
just before and after URL. Regex by @joliss. Random entity
escaping by xcode. Issue 8925

2020-06-08: [python] Fix wrong version number in error
message, bump version to 1.14

2020-06-08: Fix path to it2run

2020-06-08: Copy nightly builds to dropbox

2020-06-06: Add dragging source support to toolbelt views
for command history, recent directories, and paste history.
Issue 8932

2020-06-06: Make multiserver cd to root when starting up in
case it's launched in a network path that disappears

2020-06-03: Remove the pause mode announcement properly when
you press a key. Unpause when attaching if tmux 3.2+ since a
pane might get paused right away

2020-06-03: Add support for tmux pause mode. Still lots of
polish needed around the UI and testing. For all the gory
details see https://github.com/tmux/tmux/issues/2217

2020-06-01: Fix build

2020-06-01: Don't append nil to debug string if the complex
character is missing. Issue 8922
